{"singlePage": [], "startSite": "", "filingNum": "", "onePageListNum": 15, "commentLabelColor": "#006b75", "yearColorList": ["#bc4c00", "#0969da", "#1f883d", "#A333D0"], "i18n": "CN", "themeMode": "manual", "dayTheme": "light", "nightTheme": "dark", "urlMode": "issue", "script": "", "style": "", "indexScript": "", "indexStyle": "", "bottomText": "", "showPostSource": 0, "iconList": {}, "UTC": 8, "rssSplit": "sentence", "exlink": {}, "needComment": 1, "title": "XiaFan's Vision", "homeUrl": "https://blog.motofans.club", "subTitle": "\u4e0d\u8fc7\u7ecf\u9a8c\u4e4b\u8c08", "avatarUrl": "https://github.githubassets.com/favicons/favicon.svg", "GMEEK_VERSION": "last", "postListJson": {"P1": {"htmlDir": "docs/post/1.html", "labels": ["P-Infra"], "postTitle": "\u9ad8\u6027\u80fd DNS \u670d\u52a1\u5668: SmartDNS", "postUrl": "post/1.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/1", "commentNum": 0, "wordCount": 5112, "description": "\u5728\u5e7f\u57df\u7f51\u4e0a\u63d0\u4f9b\u7684\u516c\u5171 DNS \u5b9e\u9645\u4e0a\u662f\u6709 QOS \u9650\u5236\u7684\uff0c\u5e76\u4e14\u7531\u4e8e\u4e2d\u56fd\u5927\u9646\u7279\u6b8a\u7684\u7f51\u7edc\u60c5\u51b5\uff0c\u7ecf\u5e38\u5bb9\u6613\u83b7\u5f97\u88ab\u6c61\u67d3\u7684 DNS \u89e3\u6790\u3002", "top": 0, "createdAt": 1720089469, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P2": {"htmlDir": "docs/post/2.html", "labels": ["Azure"], "postTitle": "Azure Blob \u517c\u5bb9 S3-API", "postUrl": "post/2.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/2", "commentNum": 0, "wordCount": 2269, "description": "\u5c3d\u7ba1 S3 \u4f3c\u4e4e\u5df2\u7ecf\u6210\u4e3a\u4e91\u5b58\u50a8\u7684\u4e8b\u5b9e\u6807\u51c6\uff0c\u4e0d\u8fc7 Azure Blob \u5e76\u4e0d\u652f\u6301\u3002", "top": 0, "createdAt": 1720092226, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P3": {"htmlDir": "docs/post/3.html", "labels": ["P-Infra"], "postTitle": "OSPF + tun2socks \u5b9e\u73b0\u5168\u5c40\u4ee3\u7406", "postUrl": "post/3.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/3", "commentNum": 0, "wordCount": 4606, "description": "*\u672c\u6587\u7684\u65b9\u6848\u662f\u4e3a\u6807\u51c6\u4ee3\u7406\u670d\u52a1\u5668 HTTP(S) \u4e0e Socks \u800c\u8bbe\u8ba1\u7684\u3002", "top": 0, "createdAt": 1720105824, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P4": {"htmlDir": "docs/post/4.html", "labels": ["\u6027\u80fd\u4f18\u5316"], "postTitle": "\u4f7f\u7528 ULogd \u6536\u96c6 Iptables \u7684\u65e5\u5fd7", "postUrl": "post/4.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/4", "commentNum": 0, "wordCount": 1872, "description": "## \u80cc\u666f\r\n\r\n\u5728\u5145\u5f53 NAT \u7f51\u5173\u7684\u4e24\u4e2a CentOS 7 \u670d\u52a1\u5668\u4e0a\uff0c\u56e0\u4e3a\u5ba1\u8ba1\u9700\u6c42\uff0c\u9700\u8981\u6253\u5f00 Iptables \u7684 Log\u3002", "top": 0, "createdAt": 1720105956, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P5": {"htmlDir": "docs/post/5.html", "labels": ["\u77e5\u8bc6\u5e93"], "postTitle": "Linux \u7684\u8def\u7531\u8868", "postUrl": "post/5.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/5", "commentNum": 0, "wordCount": 2213, "description": "## \u57fa\u7840\r\n\r\n\u5728\u4e00\u4e2a\u5728\u672a\u7ecf\u8fc7\u4fee\u6539\u7684\u7cfb\u7edf\u4e0a\uff0c\u5185\u5efa\u4e86\u4ee5\u4e0b\u51e0\u5f20\u8def\u7531\u8868\r\n\r\n- **local**: \u672c\u5730\u8868\uff0c\u5904\u7406\u670d\u52a1\u5668\u5185\u90e8\u7684\u6d41\u91cf\uff0c\u5e76\u5305\u62ec\u4ee5\u592a\u7f51\u9002\u914d\u5668\u548c\u5e7f\u64ad\u6d41\u91cf\uff0c\u5728\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u4e0d\u5e94\u8be5\u4fee\u6539\u6216\u662f\u5220\u9664\u8fd9\u5f20\u8868\u3002", "top": 0, "createdAt": 1720106009, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P6": {"htmlDir": "docs/post/6.html", "labels": ["Network"], "postTitle": "OpenWRT Stable Release \u7f16\u8bd1", "postUrl": "post/6.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/6", "commentNum": 0, "wordCount": 4884, "description": "## \u524d\u8a00\r\n\r\n\u6211\u662f\u4e0d\u592a\u559c\u6b22 OpenWRT \u7684\uff0c\u76f8\u6bd4\u6765\u8bf4 RouterOS \u662f\u6211\u66f4\u4e2d\u610f\u7684\u3002", "top": 0, "createdAt": 1720106055, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P7": {"htmlDir": "docs/post/7.html", "labels": ["\u6545\u969c\u5904\u7406"], "postTitle": "Jumpserver \u5207\u6362 SQLiite \u5230 MYSQL", "postUrl": "post/7.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/7", "commentNum": 0, "wordCount": 2738, "description": "## \u80cc\u666f\r\n\r\n\u56e0\u4e3a\u5347\u7ea7\u548c\u5206\u5e03\u5f0f\u90e8\u7f72\uff0c\u73b0\u5728\u9700\u8981\u5c06 jumpserver \u7684\u6570\u636e\u5e93\u4ece SQLite \u5207\u6362\u4e3a MySQL/Mariadb\r\n\r\n\u7f51\u4e0a\u641c\u4e86\u4e00\u5708\uff0c\u6ca1\u89c1\u5230\u6709\u4eba\u5199\u8fd9\u4e2a\uff0c\u53ef\u80fd\u6ca1\u6709\u5012\u9709\u86cb\u9700\u8981\u586b\u8fd9\u4e2a\u5751\u5427\u3002", "top": 0, "createdAt": 1720106140, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P8": {"htmlDir": "docs/post/8.html", "labels": ["DevOPS"], "postTitle": "\u5ba2\u5236\u5316 Redhat/CentOS 8", "postUrl": "post/8.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/8", "commentNum": 0, "wordCount": 896, "description": "## \u80cc\u666f\r\n\r\nRedhat/CentOS \u5728 release 8 \u540e\uff0c\u6ca1\u6709\u518d\u63d0\u4f9b minimal \u955c\u50cf\u3002", "top": 0, "createdAt": 1720106398, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P9": {"htmlDir": "docs/post/9.html", "labels": ["Proxmox", "KVM"], "postTitle": "Proxmox \u5f00\u542f PCI Passthrough", "postUrl": "post/9.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/9", "commentNum": 0, "wordCount": 3295, "description": "## \u524d\u8a00\r\n\r\n\u4e3a\u4e86\u63d0\u9ad8\u865a\u62df\u673a\u7684\u6027\u80fd\uff0c\u6216\u662f\u6269\u5c55\u5176\u4f7f\u7528\u573a\u666f\u3002", "top": 0, "createdAt": 1720106486, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P10": {"htmlDir": "docs/post/10.html", "labels": ["CI/CD"], "postTitle": "\u4f7f\u7528 GCS \u7684 Maven \u4e2d\u592e\u4ed3\u5e93", "postUrl": "post/10.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/10", "commentNum": 0, "wordCount": 510, "description": "\u672c\u6587\u6700\u540e\u4fee\u8ba2\u65f6\u95f4\u4e3a 2024 \u5e74 07 \u6708 06 \u65e5\uff0c\u4ee5\u4e0b\u63cf\u8ff0\u57fa\u4e8e\u672c\u6587\u6700\u540e\u4fee\u8ba2\u65f6\u95f4\u53ef\u80fd\u4f1a\u6709\u8c03\u6574\u3002", "top": 0, "createdAt": 1720106973, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P11": {"htmlDir": "docs/post/11.html", "labels": ["Winodws"], "postTitle": "\u4ece\u7f51\u7edc\u4f4d\u7f6e\u5b89\u88c5 MS Office", "postUrl": "post/11.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/11", "commentNum": 0, "wordCount": 2247, "description": "\u53ef\u4e0d\u53ef\u4ee5\u5728\u5c40\u57df\u7f51\u5185\u4f7f\u7528 Samba (\u5171\u4eab\u6587\u4ef6\u5939) \u6765\u5b89\u88c5 Office 2016/2019 \u5462\uff1f\r\n\r\n\u5f53\u7136\u662f\u53ef\u4ee5\u7684\u3002", "top": 0, "createdAt": 1720107018, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P12": {"htmlDir": "docs/post/12.html", "labels": ["CI/CD"], "postTitle": "Jenkins \u4f7f\u7528 Inbound Agent", "postUrl": "post/12.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/12", "commentNum": 0, "wordCount": 1968, "description": "\u5728 Jenkins \u4f7f\u7528 distributed builds \u65f6\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u4e00\u4e9b\u7279\u5b9a\u7684\u7f51\u7edc\u73af\u5883\u4f7f\u5f97 Jenkins Master \u65e0\u6cd5\u901a\u8fc7 SSH Agent \u4e00\u7c7b\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e3b\u52a8\u7684\u4e0e Jenkins Node \u5efa\u7acb\u94fe\u63a5\u3002", "top": 0, "createdAt": 1720107077, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P13": {"htmlDir": "docs/post/13.html", "labels": ["Kubernetes"], "postTitle": "Charmed Kubernetes - 1: Bootstrap a Controller", "postUrl": "post/13.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/13", "commentNum": 0, "wordCount": 2685, "description": "This section will cover how to deploy a Controller in a bare-metal environment.\r\n\r\nFor The official documentation is already well-prepared for public cloud environments. If you are not deploying in a bare-metal environment, Please refer to https://ubuntu.com/kubernetes/docs for more information.\r\n\r\n## Install Juju\r\n\r\nJuju is a tool that helps automate the deployment, configuration, and management of applications in cloud environments. It makes it easier to manage multiple applications and their interactions within the cloud.\r\n\r\n```bash\r\nsudo snap install juju --channel=2.9 --classic\r\n```\r\n\r\n## Setting up password-less login\r\n\r\nGenerate SSH keys:\r\n\r\n```\r\nssh-keygen\r\n```\r\n\r\nCopy the generated SSH keys to the specified address\r\n\r\n> Replace 'ares@100.64.1.81' with the actual username and IP address. The following steps will continue in the same manner. There will be no further prompts.\r\n\r\n```\r\nssh-copy-id ares@100.64.1.81\r\n```\r\n\r\n## Create a Cloud\r\n\r\nSince we are not generating the nodes to be deployed via a cloud environment or infrastructure API, please enter 'manual' here.\r\n\r\n> You can give a name to your private cloud. I'll use 'ares-homelab' here.\r\n\r\n```\r\njuju add-cloud\r\n\r\nThis operation can be applied to both a copy on this client and to the one on a controller.\r\nNo current controller was detected and there are no registered controllers on this client: either bootstrap one or register one.\r\nCloud Types\r\n  lxd\r\n  maas\r\n  manual\r\n  openstack\r\n  vsphere\r\n\r\nSelect cloud type: manual\r\n\r\nEnter a name for your manual cloud: ares-homelab\r\n\r\nEnter the ssh connection string for controller, username@<hostname or IP> or <hostname or IP>: ares@100.64.1.81\r\n\r\nCloud 'ares-homelab' successfully added to your local client.\r\n\r\n```\r\n\r\n## Bootstrap a Controller\r\n\r\nThe Juju controller is used to manage the software deployed through Juju, from deployment to upgrades to day-two operations. One Juju controller can manage multiple projects or workspaces, which in Juju are known as \u2018models\u2019.\r\n\r\n> You can give a name to your Controller. I'll use 'infra-demo' here.\r\n\r\n```Bash\r\njuju bootstrap ares-homelab infra-demo --no-gui\r\n```\r\n\r\n## Enable Controller HA\r\n\r\nIn a production environment, it is recommended to deploy the Controller in high-availability (HA) mode, with a suggested number of 3 or 5 nodes. If you are only testing, this step can be skipped.\r\n\r\n> Enabling HA requires a minimum of three nodes\r\n\r\n```Bash\r\nssh-copy-id ares@100.64.1.82\r\nssh-copy-id ares@100.64.1.83\r\njuju add-machine -m controller <ssh:ares@100.64.1.82>\r\njuju add-machine -m controller <ssh:ares@100.64.1.83>\r\njuju machines -m controller\r\njuju enable-ha --to=1,2\r\njuju controllers --refresh\r\n```\u3002", "top": 0, "createdAt": 1720107791, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P14": {"htmlDir": "docs/post/14.html", "labels": ["Kubernetes"], "postTitle": "Charmed Kubernetes - 2: Deploy Kubernetes Cluster", "postUrl": "post/14.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/14", "commentNum": 0, "wordCount": 11259, "description": "In this section, I will show how to deploy Kubernetes 1.21 with Calico CNI plugin.\r\n\r\nPlease ensure that you have a sufficient number of nodes prepared and have already installed Ubuntu Server 20.04.\r\n\r\nThe same deployment method is applicable at least until version 1.23 and has been verified to be upgradable to the current latest version 1.27 in subsequent articles.\r\n\r\n## Add a Model\r\n\r\nThe model holds a specific deployment. It is a good idea to create a new one specifically for each deployment.\r\n\r\n```\r\njuju add-model k8s-lab\r\n\r\n```\r\n\r\nRemember that you can have multiple models on each controller, so you can deploy multiple Kubernetes clusters, or other applications.\r\n\r\n## Machine Preparation\r\n\r\n### Add some machines\r\n\r\nFor a Production-Ready Charmed Kubernetes, you should have at least three etcd nodes, two master nodes, and several worker nodes. All these nodes should have password-less login set up in advance.\r\n\r\n:::tip{title='Note'}\r\nthe master and etcd are not deployed on the same node. Although they can be deployed on the same node, I recommend deploying etcd separately.\r\n:::\r\n\r\n```\r\njuju switch k8s-lab\r\n# ETCD\r\njuju add-machine <ssh:ares@100.64.1.121>\r\njuju add-machine <ssh:ares@100.64.1.122>\r\njuju add-machine <ssh:ares@100.64.1.123>\r\n# Master\r\njuju add-machine <ssh:ares@100.64.1.124>\r\njuju add-machine <ssh:ares@100.64.1.125>\r\n# Worker\r\njuju add-machine <ssh:ares@100.64.1.126>\r\njuju add-machine <ssh:ares@100.64.1.127>\r\n# kubeapi-load-balancer\r\n# If you are using an external load balancer, these two machines are not necessary.\r\njuju add-machine <ssh:ares@100.64.1.128>\r\njuju add-machine <ssh:ares@100.64.1.129>\r\n\r\n```\r\n\r\n### View existing machines\r\n\r\nRun the following command to see if the machine has been set up. Also, make sure to remember the machine's ID because we'll need it for our deployment later on.\r\n\r\n```\r\njuju status\r\nModel    Controller  Cloud/Region            Version  SLA          Timestamp\r\nk8s-lab  infra-demo  ares-homelab/default  2.9.25   unsupported  02:09:31Z\r\n\r\nMachine  State    DNS           Inst id              Series  AZ  Message\r\n0        started  100.64.1.121  manual:100.64.1.121  focal       Manually provisioned machine\r\n1        started  100.64.1.122  manual:100.64.1.122  focal       Manually provisioned machine\r\n...\r\n6        started  100.64.1.127  manual:100.64.1.127  focal       Manually provisioned machine\r\n7        started  100.64.1.128  manual:100.64.1.128  focal       Manually provisioned machine\r\n8        started  100.64.1.129  manual:100.64.1.129  focal       Manually provisioned machine\r\n\r\n```\r\n\r\n## Deploy Kubernetes\r\n\r\nNow, we begin deploying Kubernetes according to the roles assigned to the machine in the Machine Preparation step.\r\n\r\nDownload https://git.motofans.club/Motofans/charmed-kubernetes/archive/Bugfix-Release_657.zip and unzip it.\r\n\r\nPlease proceed with the following deployment command\uff1a\r\n\r\n:::warning{title='Note'}\r\nAt the beginning, we will not deploy it in a high-availability state. We will temporarily deploy only a single replica for each component.\r\n\r\nPlease make sure to replace the 'service-cidr' and 'calico-cidr' with the appropriate values.\r\n\r\nWe use Calico CNI and enable IgnoreLooseRPF, You need to install ethtool on the machine in advance.\r\n:::\r\n\r\n```\r\n# Core\r\nfor i in {0..7}; do\r\n  juju scp resources/core/core.* $i:\r\n  juju run --machine $i 'sudo snap ack /home/ubuntu/core.assert'\r\n  juju run --machine $i 'sudo snap install --dangerous /home/ubuntu/core.snap'\r\ndone\r\n\r\n# EasyRSA\r\njuju deploy --to 0 ./easyrsa\r\njuju attach easyrsa easyrsa=./resources/easyrsa/easyrsa.tgz\r\n\r\n# ETCD\r\njuju deploy --to 0 ./etcd \\\\\r\n    --config bind_to_all_interfaces=false \\\\\r\n    --config channel=3.4/stable\r\njuju attach etcd snapshot=./resources/etcd/snapshot.gz\r\njuju attach etcd etcd=./resources/etcd/etcd.snap\r\n\r\n# Containerd\r\njuju deploy ./containerd\r\n\r\n# Kubernetes-master\r\n# Disable the built-in dashboard\r\n# Use the IPVS mode\r\njuju deploy --to 3 ./kubernetes-master \\\\\r\n    --config channel=1.21/stable \\\\\r\n    --config service-cidr=172.31.192.0/21 \\\\\r\n    --config enable-dashboard-addons=false \\\\\r\n    --config image-registry=jcr.motofans.club/mirror/rocks.canonical.com/cdk \\\\\r\n    --config proxy-extra-args='bind-address=0.0.0.0 proxy-mode=ipvs'\r\njuju attach kubernetes-master core=./resources/core/core.snap\r\njuju attach kubernetes-master cdk-addons=./resources/kubernetes-master/cdk-addons.snap\r\njuju attach kubernetes-master kube-apiserver=./resources/kubernetes-master/kube-apiserver.snap\r\njuju attach kubernetes-master kube-controller-manager=./resources/kubernetes-master/kube-controller-manager.snap\r\njuju attach kubernetes-master kube-scheduler=./resources/kubernetes-master/kube-scheduler.snap\r\njuju attach kubernetes-master kube-proxy=./resources/kubernetes-master/kube-proxy.snap\r\njuju attach kubernetes-master kubectl=./resources/kubernetes-master/kubectl.snap\r\n\r\n# Kubernetes-worker\r\n# Use the IPVS mode\r\njuju deploy --to 5 ./kubernetes-worker \\\\\r\n    --config channel=1.21/stable \\\\\r\n    --config ingress=false \\\\\r\n    --config proxy-extra-args='bind-address=0.0.0.0 proxy-mode=ipvs'\r\njuju attach kubernetes-worker cni-amd64=./resources/kubernetes-worker/cni-amd64.tgz\r\njuju attach kubernetes-worker kube-proxy=./resources/kubernetes-worker/kube-proxy.snap\r\njuju attach kubernetes-worker kubectl=./resources/kubernetes-worker/kubectl.snap\r\njuju attach kubernetes-worker kubelet=./resources/kubernetes-worker/kubelet.snap\r\n\r\n# Calico\r\njuju deploy ./calico \\\\\r\n    --config cidr=172.31.128.0/18 \\\\\r\n    --config vxlan=Always \\\\\r\n    --config ignore-loose-rpf=true\r\njuju attach calico calico=./resources/calico/calico.gz\r\njuju attach calico calico-node-image=./resources/calico/calico-node-image.gz\r\njuju attach calico calico-upgrade=./resources/calico/calico-upgrade.gz\r\n\r\n# Add relate\r\njuju relate etcd:certificates easyrsa:client\r\njuju relate kubernetes-master:kube-control kubernetes-worker:kube-control\r\njuju relate kubernetes-master:certificates easyrsa:client\r\njuju relate kubernetes-worker:certificates easyrsa:client\r\njuju relate kubernetes-master:etcd etcd:db\r\njuju relate containerd:containerd kubernetes-worker:container-runtime\r\njuju relate containerd:containerd kubernetes-master:container-runtime\r\njuju relate kubernetes-master:kube-api-endpoint kubernetes-worker:kube-api-endpoint\r\njuju relate calico:etcd etcd:db\r\njuju relate calico:cni kubernetes-master:cni\r\njuju relate calico:cni kubernetes-worker:cni\r\n\r\n```\r\n\r\nJuju is now busy creating instances, installing software and connecting the different parts of the cluster together, which can take several minutes. You can monitor what\u2019s going on by running:\r\n\r\n```\r\nwatch -c juju status --color\r\n\r\n```\r\n\r\nOnce all the workloads are displayed as active, we can start increasing the number of replicas for the components by running:\r\n\r\n```\r\njuju add-unit etcd --to 1\r\njuju add-unit etcd --to 2\r\njuju add-unit kubernetes-master --to 4\r\njuju add-unit kubernetes-worker --to 6\r\n\r\n```\r\n\r\n## KubeAPI Load Balancer\r\n\r\nOnce the scaling is complete, We've got two Master nodes, and to spread the load across both, we need to bring in a load balancer (LB). This LB can be set up using a controller internally, or externally using F5 or other load balancing devices.\r\n\r\n### Software LB\r\n\r\n*If you are using an external load balancer, you can skip this part.*\r\n\r\nHere's how to set up the software LB using a controller.\r\n\r\n```\r\nexport VIP=100.64.1.128\r\nexport VIP_HOSTNAME=kube-api.motofans.club\r\njuju deploy --to 7 ./kubeapi-load-balancer\r\n\r\njuju config kubernetes-master extra_sans='$VIP $VIP_HOSTNAME'\r\njuju config kubeapi-load-balancer extra_sans='$VIP $VIP_HOSTNAME'\r\n\r\njuju remove-relation kubernetes-master:kube-api-endpoint kubernetes-worker:kube-api-endpoint\r\n\r\njuju relate kubernetes-master:kube-api-endpoint kubeapi-load-balancer:apiserver\r\njuju relate kubernetes-worker:kube-api-endpoint kubeapi-load-balancer:website\r\njuju relate kubeapi-load-balancer:certificates easyrsa:client\r\njuju relate kubernetes-master:loadbalancer kubeapi-load-balancer:loadbalancer\r\n\r\n```\r\n\r\nNow, we have a load balancer distributing requests across two master nodes.\r\n\r\nYou may have noticed that the load balancer itself isn't highly available as it's deployed on a specific node. If this node experiences issues, worker nodes will be unable to access the master nodes. We can solve this issue by deploying Keepalived:\r\n\r\n```\r\nexport VIP=100.64.1.110\r\nexport VIP_HOSTNAME=kube-api.motofans.club\r\njuju deploy ./keepalived\r\n\r\njuju config keepalived virtual_ip=$VIP\r\njuju config keepalived vip_hostname=$VIP_HOSTNAME\r\njuju config kubeapi-load-balancer extra_sans='$VIP $VIP_HOSTNAME'\r\njuju config kubernetes-master extra_sans='$VIP $VIP_HOSTNAME'\r\n\r\njuju add-relation keepalived:juju-info kubeapi-load-balancer:juju-info\r\njuju add-relation keepalived:lb-sink kubeapi-load-balancer:website\r\njuju add-relation keepalived:loadbalancer kubernetes-master:loadbalancer\r\njuju add-relation keepalived:website kubernetes-worker:kube-api-endpoint\r\n\r\njuju remove-relation kubernetes-worker:kube-api-endpoint kubeapi-load-balancer:website\r\njuju remove-relation kubernetes-master:loadbalancer kubeapi-load-balancer:loadbalancer\r\n\r\njuju add-unit kubeapi-load-balancer --to 8\r\n\r\njuju config kubernetes-master proxy-extra-args='bind-address=0.0.0.0 proxy-mode=ipvs master=https://kube-api.motofans.club:443'\r\njuju config kubernetes-worker proxy-extra-args='bind-address=0.0.0.0 proxy-mode=ipvs master=https://kube-api.motofans.club:443'\r\n\r\n```\r\n\r\n### External Load Balancer\r\n\r\n**Recommendation**\r\n\r\n*If you are not using an external load balancer, you can skip this part.*\r\n\r\nWhen using an external load balancer, you need to distribute the traffic to two Master nodes, and it is recommended to ensure high availability of the external load balancer in a production environment.\r\n\r\n```\r\njuju config kubernetes-master extra_sans='$VIP $VIP_HOSTNAME'\r\njuju config kubernetes-master loadbalancer-ips='$VIP $VIP_HOSTNAME'\r\n\r\n```\r\n\r\n## Retrieve Config File\r\n\r\nFinally, You can use the following command to retrieve the cluster config file:\r\n\r\n```\r\nmkdir -p .kube\r\njuju scp kubernetes-master/0:config ~/.kube/config\r\n\r\n```\r\n\r\n## Use CoreDNS charm\r\n\r\nCoreDNS has been the default DNS provider for Charmed Kubernetes clusters since 1.14. It will be installed and configured as part of the install process of Charmed Kubernetes.\r\n\r\nFor additional control over CoreDNS, you can also deploy it into the cluster using the [[CoreDNS Kubernetes operator charm](https://charmhub.io/coredns)](https://charmhub.io/coredns).\r\n\r\n```\r\njuju config -m k8s-lab kubernetes-master dns-provider=none\r\njuju add-k8s k8s-cloud --controller infra-demo\r\njuju add-model k8s-model k8s-cloud\r\ncat ./resources/coredns-image.tgz\r\njuju deploy ./coredns --resource coredns-image=./resources/coredns-image.tgz\r\njuju offer coredns:dns-provider\r\njuju consume -m k8s-lab k8s-model.coredns\r\njuju relate -m k8s-lab coredns kubernetes-master\r\n\r\n```\r\n\r\nOnce everything settles out, new or restarted pods will use the CoreDNS charm as their DNS provider. The CoreDNS charm config allows you to change the cluster domain, the IP address or config file to forward unhandled queries to, add additional DNS servers, or even override the Corefile entirely.\u3002", "top": 0, "createdAt": 1720107868, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P15": {"htmlDir": "docs/post/15.html", "labels": ["Kubernetes"], "postTitle": "Charmed Kubernetes - 3: Upgrade Kubernetes Cluster", "postUrl": "post/15.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/15", "commentNum": 0, "wordCount": 2759, "description": "## Infrastructure updates\r\n\r\n### Containerd\r\n\r\n```\r\njuju upgrade-charm containerd --path=./containerd\r\n\r\n```\r\n\r\n### ETCD\r\n\r\n```\r\njuju upgrade-charm etcd --path=./etcd\r\njuju config etcd channel=3.4/stable\r\njuju attach etcd etcd=./resources/etcd/etcd.snap\r\n\r\n```\r\n\r\n### EasyRSA\r\n\r\n```\r\njuju upgrade-charm easyrsa --path=./easyrsa --resource esayrsa=./resources/easyrsa/easyrsa.tgz\r\n\r\n```\r\n\r\n### Calico CNI\r\n\r\n```\r\njuju upgrade-charm calico --path=./calico \\\\\r\n    --resource calico=./resources/calico/calico.gz \\\\\r\n    --resource calico-node-image=./resources/calico/calico-node-image.gz \\\\\r\n    --resource calico-upgrade=./resources/calico/calico-upgrade.gz\r\n\r\n```\r\n\r\n## Upgrading Kubernetes\r\n\r\n### KubeAPI Load Balancer\r\n\r\n```\r\njuju upgrade-charm kubeapi-load-balancer --path=./kubeapi-load-balancer\r\njuju upgrade-charm keepalived --path=./keepalived\r\n\r\n```\r\n\r\n### Kubernetes-Master Units\r\n\r\n```\r\njuju upgrade-charm kubernetes-master --path=./kubernetes-master \\\\\r\n    --resource cni-amd64=./resources/kubernetes-master/cni-amd64.tgz \\\\\r\n    --resource cni-arm64=./resources/kubernetes-master/cni-arm64.tgz \\\\\r\n    --resource cni-s390x=./resources/kubernetes-master/cni-s390x.tgz\r\njuju attach kubernetes-master core=./resources/core/core.snap\r\njuju attach kubernetes-master cdk-addons=./resources/kubernetes-master/cdk-addons.snap\r\njuju attach kubernetes-master kube-apiserver=./resources/kubernetes-master/kube-apiserver.snap\r\njuju attach kubernetes-master kube-controller-manager=./resources/kubernetes-master/kube-controller-manager.snap\r\njuju attach kubernetes-master kube-scheduler=./resources/kubernetes-master/kube-scheduler.snap\r\njuju attach kubernetes-master kube-proxy=./resources/kubernetes-master/kube-proxy.snap\r\njuju attach kubernetes-master kubectl=./resources/kubernetes-master/kubectl.snap\r\n\r\njuju config kubernetes-master channel=1.22/stable\r\njuju run-action kubernetes-master/0 upgrade\r\njuju run-action kubernetes-master/1 upgrade\r\n\r\n```\r\n\r\n### Update Relation\r\n\r\n```\r\njuju add-relation kubernetes-master:loadbalancer-external kubeapi-load-balancer:lb-consumers\r\njuju add-relation kubernetes-master:loadbalancer-internal kubeapi-load-balancer:lb-consumers\r\n\r\n```\r\n\r\n### Kubernetes-Worker Units\r\n\r\n```\r\njuju upgrade-charm kubernetes-worker --path=./kubernetes-worker \\\\\r\n    --resource cni-amd64=./resources/kubernetes-worker/cni-amd64.tgz\r\njuju attach kubernetes-worker kube-proxy=./resources/kubernetes-worker/kube-proxy.snap\r\njuju attach kubernetes-worker kubectl=./resources/kubernetes-worker/kubectl.snap\r\njuju attach kubernetes-worker kubelet=./resources/kubernetes-worker/kubelet.snap\r\n\r\njuju config kubernetes-worker channel=1.22/stable\r\njuju run-action kubernetes-worker/0 upgrade\r\njuju run-action kubernetes-worker/1 upgrade\r\n\r\n```\u3002", "top": 0, "createdAt": 1720107926, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P16": {"htmlDir": "docs/post/16.html", "labels": ["P-Infra"], "postTitle": "\u66f4\u597d\u7684\u5185\u7f51\u7a7f\u900f: Boringproxy", "postUrl": "post/16.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/16", "commentNum": 0, "wordCount": 2301, "description": "## \u80cc\u666f\r\n\r\n\u5bb6\u91cc\u9762\u6ca1\u6709\u56fa\u5b9a\u7684\u516c\u7f51 IP \u5730\u5740\uff0c\u8def\u7531\u5668\u53c8\u4e0d\u662f\u6700\u5916\u9762\u7684\u4e00\u5c42\uff0c\u56e0\u6b64 DDNS \u4e5f\u6ca1\u6cd5\u641e\u3002", "top": 0, "createdAt": 1720107988, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P17": {"htmlDir": "docs/post/17.html", "labels": ["\u77e5\u8bc6\u5e93"], "postTitle": "\u8ba4\u8bc6\u56fa\u6001\u786c\u76d8", "postUrl": "post/17.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/17", "commentNum": 0, "wordCount": 2528, "description": "<h2>\u524d\u8a00</h2>\r\n<p>\u300c\u672c\u6587\u9762\u5411\u4f01\u4e1a\u79d1\u666e/\u5e02\u573a\u63d0\u4f9b\u300d</p>\r\n<h2>\u95ea\u5b58\u7684\u5b9a\u4e49</h2>\r\n<p>\u95ea\u5b58\u662f\u4e00\u79cd\u56fa\u6001\u6280\u672f\uff0c\u4f7f\u7528\u95ea\u5b58\u82af\u7247\u5199\u5165\u548c\u5b58\u50a8\u6570\u636e\uff0c\u5b83\u4f7f\u7528\u975e\u6613\u5931\u6027\u5b58\u50a8\u5668\uff0c\u8fd9\u610f\u5473\u7740\u5f53\u7535\u6e90\u5173\u95ed\u65f6\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002", "top": 0, "createdAt": 1720108033, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P18": {"htmlDir": "docs/post/18.html", "labels": ["P-Infra", "Network"], "postTitle": "OpenWRT + \u79fb\u8fdc EC20 \u63a5\u5165 LTE", "postUrl": "post/18.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/18", "commentNum": 0, "wordCount": 490, "description": "## \u524d\u8a00\r\n\r\n\u5728 [OpenWRT Stable Release \u7f16\u8bd1 ](https://blog.motofans.club/post/6.html) \u8fd9\u7bc7\u535a\u6587\u4e2d\u6211\u63d0\u5230\u4e86\u6211\u5728\u4f7f\u7528 EC20 \u5b9e\u73b0\u4e00\u4e2a CPE \u8bbe\u5907\u3002", "top": 0, "createdAt": 1720108184, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P19": {"htmlDir": "docs/post/19.html", "labels": ["Python"], "postTitle": "Python \u4f7f\u7528\u6807\u51c6\u5e93\u83b7\u53d6\u7f51\u5361\u7684 IP", "postUrl": "post/19.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/19", "commentNum": 0, "wordCount": 966, "description": "\u5f88\u591a\u65f6\u5019\u9700\u8981\u5728 Python \u83b7\u53d6\u6307\u5b9a\u7f51\u5361\u7684 IP \u5730\u5740\u3002", "top": 0, "createdAt": 1720108445, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P20": {"htmlDir": "docs/post/20.html", "labels": ["P-Infra"], "postTitle": "\u4e2a\u4eba\u4e91\u5b58\u50a8\u65b9\u6848\u8bbe\u8ba1", "postUrl": "post/20.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/20", "commentNum": 0, "wordCount": 1426, "description": "*\u524d\u6392\u529d\u9000\uff0c\u8fd9\u4e0d\u662f\u4e00\u4e2a\u514d\u8d39\u7684\u4e2a\u4eba\u4e91\u5b58\u50a8\u65b9\u6848\uff0c\u5b83\u7684\u5b9e\u73b0\u9700\u8981\u4f60\u6295\u5165\u4e00\u5b9a\u7684\u6210\u672c\u3002", "top": 0, "createdAt": 1720108493, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P21": {"htmlDir": "docs/post/21.html", "labels": ["P-Infra"], "postTitle": "Garage: S3 \u517c\u5bb9\u5bf9\u8c61\u5b58\u50a8", "postUrl": "post/21.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/21", "commentNum": 0, "wordCount": 1069, "description": "## \u80cc\u666f\r\n\r\n\u4e00\u76f4\u4ee5\u6765\uff0c\u8981\u600e\u4e48\u80fd\u591f\u8ba9\u5728 EPIC-KBS9 \u4e0a\u90e8\u7f72\u7684 Seafile \u80fd\u591f\u7a33\u5b9a\u9ad8\u6548\u7684\u8bbf\u95ee\u5230 Riverbed CX570 \u7684 ZFS \u9635\u5217\u90fd\u662f\u8ba9\u6211\u89c9\u5f97\u9700\u8981\u6539\u8fdb\u7684\u5730\u65b9\u3002", "top": 0, "createdAt": 1720108549, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P22": {"htmlDir": "docs/post/22.html", "labels": ["Azure"], "postTitle": "AKS \u4e0a\u9762\u7684\u5751", "postUrl": "post/22.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/22", "commentNum": 0, "wordCount": 1790, "description": "\u6211\u4eec\u6709\u4e24\u5957 AKS \uff08Azure Kubernetes Service\uff09\uff0c\u4e00\u5957\u7528\u4e8e\u6d4b\u8bd5\u73af\u5883\uff0c\u53e6\u4e00\u5957\u5219\u662f\u6295\u4ea7\u4f7f\u7528\u3002", "top": 0, "createdAt": 1720108600, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P23": {"htmlDir": "docs/post/23.html", "labels": ["Kubernetes"], "postTitle": "Nginx-Ingress \u4e00\u81f4\u6027\u54c8\u5e0c", "postUrl": "post/23.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/23", "commentNum": 0, "wordCount": 776, "description": "\u6709\u6ca1\u6709\u529e\u6cd5\u8ba9\u540c\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u843d\u5728\u540c\u4e00\u4e2a Pod \u4e0a\u9762\uff1f\r\n\r\n\u5728\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u4e4b\u524d\u6211\u4eec\u5148\u6765\u770b\u770b Nginx-Ingress \u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002", "top": 0, "createdAt": 1720108633, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P24": {"htmlDir": "docs/post/24.html", "labels": ["Kubernetes"], "postTitle": "\u5b89\u5168\u7684\u4f7f\u7528 Cert Manager", "postUrl": "post/24.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/24", "commentNum": 0, "wordCount": 2550, "description": "## \u524d\u8a00\r\n\r\n\u5728 Kubernetes \u4e0a\u4f7f\u7528 Cert Manager \u7684 ACME DNS Challenge \u65b9\u5f0f\u80fd\u591f\u5f88\u8f7b\u677e\u7684\u4e3a\u57df\u540d\u7b7e\u53d1\u4e00\u5f20\u53d7\u4fe1\u4efb\u7684\u6cdb\u57df\u540d\u8bc1\u4e66\u3002", "top": 0, "createdAt": 1720108707, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P25": {"htmlDir": "docs/post/25.html", "labels": ["\u6027\u80fd\u4f18\u5316"], "postTitle": "Zookeeper in Production", "postUrl": "post/25.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/25", "commentNum": 0, "wordCount": 1221, "description": "\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8fd0\u884c zookeeper \u9700\u8981\u8003\u8651\u7684\u5173\u952e\u70b9\u3002", "top": 0, "createdAt": 1720108759, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-04", "dateLabelColor": "#bc4c00"}, "P27": {"htmlDir": "docs/post/27.html", "labels": ["\u77e5\u8bc6\u5e93"], "postTitle": "\u4ece CentOS 7 \u5347\u7ea7\u5230 CentOS 9 Stream", "postUrl": "post/27.html", "postSourceUrl": "https://github.com/anonsaber/anonsaber.github.io/issues/27", "commentNum": 0, "wordCount": 8152, "description": "CentOS 7 \u4e0e CentOS 8/8-Stream \u5df2\u7ecf EOL\uff0c\u7136\u800c\u4f5c\u4e3a Red Hat Enterprise Linux \u7684\u514d\u8d39\u793e\u533a\u7248\uff0c\u4e00\u76f4\u4ee5\u6765\u5728\u670d\u52a1\u5668\u64cd\u4f5c\u7cfb\u7edf\u9886\u57df\u5360\u636e\u7740\u91cd\u8981\u5730\u4f4d\u3002", "top": 0, "createdAt": 1720345172, "style": "", "script": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2024-07-07", "dateLabelColor": "#bc4c00"}}, "singeListJson": {}, "labelColorDict": {"Azure": "#006C74", "CI/CD": "#0E9353", "DevOPS": "#817EDF", "Kubernetes": "#654EBD", "KVM": "#5E5FA0", "Network": "#818069", "P-Infra": "#5A9F0C", "Proxmox": "#B9B3A6", "Python": "#4AE160", "Winodws": "#F916ED", "\u6027\u80fd\u4f18\u5316": "#71ECCC", "\u6545\u969c\u5904\u7406": "#933FE3", "\u77e5\u8bc6\u5e93": "#E1A2EB"}, "displayTitle": "XiaFan's Vision", "faviconUrl": "https://github.githubassets.com/favicons/favicon.svg", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "primerCSS": "<link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />", "prevUrl": "/index.html", "nextUrl": "disabled"}